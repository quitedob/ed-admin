<template>
  <div class="ai-assistant">
    <div class="assistant-container">
      <!-- å·¦ä¾§è¾¹æ  -->
      <div class="sidebar">
        <div class="sidebar-header">
          <h3>AIåŠ©æ•™</h3>
          <el-button type="primary" size="small" @click="createNewConversation">
            <el-icon><Plus /></el-icon>
            æ–°å¯¹è¯
          </el-button>
        </div>

        <!-- å¯¹è¯å†å² -->
        <div class="conversation-list">
          <div
            v-for="conversation in conversationList"
            :key="conversation.id"
            class="conversation-item"
            :class="{ active: currentConversation?.id === conversation.id }"
            @click="selectConversation(conversation)"
          >
            <div class="conversation-title">{{ conversation.title }}</div>
            <div class="conversation-meta">
              <span class="course">{{ conversation.courseName }}</span>
              <span class="time">{{ formatTime(conversation.updatedAt) }}</span>
            </div>
            <div class="conversation-actions">
              <el-button type="text" size="small" @click.stop="deleteConversation(conversation)">
                <el-icon><Delete /></el-icon>
              </el-button>
            </div>
          </div>
        </div>

        <!-- å­¦ä¹ å»ºè®® -->
        <div class="suggestions-panel" v-if="suggestions.length > 0">
          <h4>å­¦ä¹ å»ºè®®</h4>
          <div class="suggestion-list">
            <div
              v-for="suggestion in suggestions"
              :key="suggestion.id"
              class="suggestion-item"
              @click="openSuggestion(suggestion)"
            >
              <el-icon :class="getSuggestionIcon(suggestion.type)">
                <component :is="getSuggestionIcon(suggestion.type)" />
              </el-icon>
              <div class="suggestion-content">
                <div class="suggestion-title">{{ suggestion.title }}</div>
                <div class="suggestion-desc">{{ suggestion.description }}</div>
              </div>
              <el-tag :type="getPriorityType(suggestion.priority)" size="small">
                {{ getPriorityLabel(suggestion.priority) }}
              </el-tag>
            </div>
          </div>
        </div>
      </div>

      <!-- ä¸»è¦å¯¹è¯åŒºåŸŸ -->
      <div class="main-content">
        <div class="chat-header" v-if="currentConversation">
          <div class="chat-title">
            <h3>{{ currentConversation.title }}</h3>
            <div class="chat-context">
              <el-tag type="info" size="small">{{ currentConversation.courseName }}</el-tag>
              <el-tag type="warning" size="small">{{ currentConversation.chapterName }}</el-tag>
            </div>
          </div>
          <div class="chat-actions">
            <el-button type="text" @click="clearChat">
              <el-icon><Refresh /></el-icon>
              æ¸…ç©ºå¯¹è¯
            </el-button>
            <el-button type="text" @click="exportChat">
              <el-icon><Download /></el-icon>
              å¯¼å‡ºå¯¹è¯
            </el-button>
          </div>
        </div>

        <!-- å¯¹è¯æ¶ˆæ¯åŒºåŸŸ -->
        <div class="chat-messages" ref="messagesContainer">
          <div v-if="!currentConversation" class="welcome-message">
            <div class="welcome-content">
              <el-icon class="welcome-icon"><ChatDotRound /></el-icon>
              <h2>æ¬¢è¿ä½¿ç”¨AIåŠ©æ•™</h2>
              <p>æˆ‘æ˜¯ä½ çš„å­¦ä¹ åŠ©æ‰‹ï¼Œå¯ä»¥å¸®ä½ ï¼š</p>
              <ul>
                <li>è§£ç­”ç¼–ç¨‹é—®é¢˜å’Œæ¦‚å¿µç–‘æƒ‘</li>
                <li>åˆ†æä»£ç å¹¶æä¾›ä¼˜åŒ–å»ºè®®</li>
                <li>æä¾›å­¦ä¹ æ€è·¯å’Œè§£é¢˜æç¤º</li>
                <li>æ¨èç›¸å…³å­¦ä¹ èµ„æº</li>
              </ul>
              <div class="quick-actions">
                <el-button type="primary" @click="askAboutConcept">è¯¢é—®æ¦‚å¿µ</el-button>
                <el-button type="success" @click="analyzeCode">åˆ†æä»£ç </el-button>
                <el-button type="warning" @click="getHint">è·å–æç¤º</el-button>
              </div>
            </div>
          </div>

          <div v-else class="messages-list">
            <div
              v-for="message in currentConversation.messages"
              :key="message.id"
              class="message"
              :class="message.type"
            >
              <div class="message-avatar">
                <el-avatar v-if="message.type === 'user'" :size="32">
                  <el-icon><User /></el-icon>
                </el-avatar>
                <el-avatar v-else :size="32" class="ai-avatar">
                  ğŸ¤–
                </el-avatar>
              </div>
              <div class="message-content">
                <div class="message-text" v-html="formatMessage(message.content)"></div>
                <div class="message-time">{{ formatTime(message.timestamp) }}</div>
                <!-- AIæ¶ˆæ¯çš„å»ºè®®æ“ä½œ -->
                <div v-if="message.type === 'ai' && message.suggestions" class="message-suggestions">
                  <div
                    v-for="suggestion in message.suggestions"
                    :key="suggestion.id"
                    class="suggestion-chip"
                    @click="applySuggestion(suggestion)"
                  >
                    <el-icon><Guide /></el-icon>
                    {{ suggestion.title }}
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- æ‰“å­—æŒ‡ç¤ºå™¨ -->
          <div v-if="isTyping" class="typing-indicator">
            <div class="typing-avatar">
              <el-avatar :size="32" class="ai-avatar">
                ğŸ¤–
              </el-avatar>
            </div>
            <div class="typing-dots">
              <span></span>
              <span></span>
              <span></span>
            </div>
          </div>
        </div>

        <!-- è¾“å…¥åŒºåŸŸ -->
        <div class="chat-input">
          <div class="input-toolbar">
            <el-button type="text" size="small" @click="insertCodeBlock">
              <el-icon><Document /></el-icon>
              ä»£ç å—
            </el-button>
            <el-button type="text" size="small" @click="attachFile">
              <el-icon><Paperclip /></el-icon>
              é™„ä»¶
            </el-button>
            <el-button type="text" size="small" @click="voiceInput">
              <el-icon><Microphone /></el-icon>
              è¯­éŸ³
            </el-button>
          </div>
          <div class="input-area">
            <el-input
              v-model="inputMessage"
              type="textarea"
              :rows="3"
              placeholder="è¾“å…¥ä½ çš„é—®é¢˜ï¼ŒæŒ‰Ctrl+Enterå‘é€..."
              @keydown.ctrl.enter="sendMessage"
              resize="none"
            />
            <el-button
              type="primary"
              :loading="isTyping"
              @click="sendMessage"
              :disabled="!inputMessage.trim()"
            >
              <el-icon><Promotion /></el-icon>
              å‘é€
            </el-button>
          </div>
          <div class="quick-questions">
            <span>å¿«é€Ÿæé—®ï¼š</span>
            <el-button
              v-for="question in quickQuestions"
              :key="question"
              type="text"
              size="small"
              @click="setQuickQuestion(question)"
            >
              {{ question }}
            </el-button>
          </div>
        </div>
      </div>

      <!-- å³ä¾§é¢æ¿ -->
      <div class="right-panel">
        <!-- çŸ¥è¯†å¡ç‰‡ -->
        <div class="knowledge-cards">
          <h4>ç›¸å…³çŸ¥è¯†</h4>
          <div class="card-list">
            <div v-for="hint in relevantHints" :key="hint.id" class="knowledge-card">
              <div class="card-header">
                <h5>{{ hint.title }}</h5>
                <el-tag :type="getDifficultyType(hint.difficulty)" size="small">
                  {{ getDifficultyLabel(hint.difficulty) }}
                </el-tag>
              </div>
              <div class="card-content">
                {{ hint.content.substring(0, 100) }}...
              </div>
              <div class="card-footer">
                <el-button type="text" size="small" @click="viewHint(hint)">
                  æŸ¥çœ‹è¯¦æƒ…
                </el-button>
              </div>
            </div>
          </div>
        </div>

        <!-- ä»£ç ç¤ºä¾‹ -->
        <div class="code-examples" v-if="codeExamples.length > 0">
          <h4>ä»£ç ç¤ºä¾‹</h4>
          <div class="example-list">
            <div v-for="example in codeExamples" :key="example.id" class="code-example">
              <div class="example-header">
                <span>{{ example.concept }} - {{ example.language }}</span>
                <el-button type="text" size="small" @click="copyCode(example.code)">
                  <el-icon><CopyDocument /></el-icon>
                </el-button>
              </div>
              <pre class="code-block"><code>{{ example.code }}</code></pre>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- çŸ¥è¯†è¯¦æƒ…å¯¹è¯æ¡† -->
    <el-dialog v-model="showHintDialog" :title="currentHint?.title" width="600px">
      <div v-if="currentHint" class="hint-detail">
        <div class="hint-meta">
          <el-tag :type="getDifficultyType(currentHint.difficulty)">
            {{ getDifficultyLabel(currentHint.difficulty) }}
          </el-tag>
          <div class="hint-tags">
            <el-tag
              v-for="tag in currentHint.tags"
              :key="tag"
              size="small"
              style="margin-right: 4px;"
            >
              {{ tag }}
            </el-tag>
          </div>
        </div>
        <div class="hint-content" v-html="formatMessage(currentHint.content)"></div>
      </div>
    </el-dialog>
  </div>
</template>

<script setup>
import { ref, reactive, onMounted, nextTick } from 'vue'
import { ElMessage, ElMessageBox } from 'element-plus'
import {
  Plus,
  Delete,
  Refresh,
  Download,
  ChatDotRound,
  User,
  Guide,
  Document,
  Paperclip,
  Microphone,
  Promotion,
  CopyDocument
} from '@element-plus/icons-vue'
import aiApi from '@/api/ai'

// å“åº”å¼æ•°æ®
const conversationList = ref([])
const currentConversation = ref(null)
const suggestions = ref([])
const relevantHints = ref([])
const codeExamples = ref([])
const inputMessage = ref('')
const isTyping = ref(false)
const messagesContainer = ref()
const showHintDialog = ref(false)
const currentHint = ref(null)

// å¿«é€Ÿé—®é¢˜
const quickQuestions = ref([
  'ä»€ä¹ˆæ˜¯é—­åŒ…ï¼Ÿ',
  'Vueç»„ä»¶å¦‚ä½•é€šä¿¡ï¼Ÿ',
  'å¦‚ä½•è°ƒè¯•JavaScriptä»£ç ï¼Ÿ',
  'ç®—æ³•è§£é¢˜æ€è·¯'
])

// è·å–å¯¹è¯åˆ—è¡¨
const getConversations = async () => {
  try {
    const response = await aiApi.getConversations({ limit: 20 })
    if (response.code === 200) {
      conversationList.value = response.data.items
    }
  } catch (error) {
    console.error('è·å–å¯¹è¯åˆ—è¡¨å¤±è´¥:', error)
  }
}

// è·å–å­¦ä¹ å»ºè®®
const getSuggestions = async () => {
  try {
    const response = await aiApi.getSuggestions(1, 1) // æ¨¡æ‹Ÿç”¨æˆ·IDå’Œè¯¾ç¨‹ID
    if (response.code === 200) {
      suggestions.value = response.data
    }
  } catch (error) {
    console.error('è·å–å­¦ä¹ å»ºè®®å¤±è´¥:', error)
  }
}

// è·å–ç›¸å…³æç¤º
const getRelevantHints = async () => {
  try {
    const response = await aiApi.getHints({ category: 'debugging' })
    if (response.code === 200) {
      relevantHints.value = response.data.slice(0, 3)
    }
  } catch (error) {
    console.error('è·å–ç›¸å…³æç¤ºå¤±è´¥:', error)
  }
}

// åˆ›å»ºæ–°å¯¹è¯
const createNewConversation = () => {
  const newConversation = {
    id: Date.now(),
    title: 'æ–°å¯¹è¯',
    messages: [],
    createdAt: new Date().toLocaleString(),
    updatedAt: new Date().toLocaleString(),
    courseId: 1,
    courseName: 'JavaScriptåŸºç¡€ç¼–ç¨‹',
    chapterId: 1,
    chapterName: 'ç¬¬1ç« ï¼šå˜é‡ä¸æ•°æ®ç±»å‹'
  }

  currentConversation.value = newConversation
  conversationList.value.unshift(newConversation)
}

// é€‰æ‹©å¯¹è¯
const selectConversation = (conversation) => {
  currentConversation.value = conversation
  // æ›´æ–°ç›¸å…³å†…å®¹
  updateRelevantContent()
}

// åˆ é™¤å¯¹è¯
const deleteConversation = async (conversation) => {
  try {
    await ElMessageBox.confirm('ç¡®å®šè¦åˆ é™¤è¿™ä¸ªå¯¹è¯å—ï¼Ÿ', 'æç¤º', {
      confirmButtonText: 'ç¡®å®š',
      cancelButtonText: 'å–æ¶ˆ',
      type: 'warning'
    })

    const response = await aiApi.deleteConversation(conversation.id)
    if (response.code === 200) {
      const index = conversationList.value.findIndex(item => item.id === conversation.id)
      if (index > -1) {
        conversationList.value.splice(index, 1)
      }

      if (currentConversation.value?.id === conversation.id) {
        currentConversation.value = null
      }

      ElMessage.success('å¯¹è¯åˆ é™¤æˆåŠŸ')
    }
  } catch (error) {
    if (error !== 'cancel') {
      ElMessage.error('åˆ é™¤å¤±è´¥')
    }
  }
}

// å‘é€æ¶ˆæ¯
const sendMessage = async () => {
  if (!inputMessage.value.trim()) return

  // å¦‚æœæ²¡æœ‰å½“å‰å¯¹è¯ï¼Œåˆ›å»ºæ–°å¯¹è¯
  if (!currentConversation.value) {
    createNewConversation()
  }

  const userMessage = {
    id: Date.now(),
    type: 'user',
    content: inputMessage.value,
    timestamp: new Date().toLocaleString()
  }

  currentConversation.value.messages.push(userMessage)
  const messageContent = inputMessage.value
  inputMessage.value = ''

  // æ»šåŠ¨åˆ°åº•éƒ¨
  await nextTick()
  scrollToBottom()

  // æ˜¾ç¤ºæ‰“å­—æŒ‡ç¤ºå™¨
  isTyping.value = true

  try {
    const response = await aiApi.sendMessage({
      message: messageContent,
      conversationId: currentConversation.value.id
    })

    if (response.code === 200) {
      const aiMessage = {
        id: response.data.id,
        type: 'ai',
        content: response.data.content,
        timestamp: response.data.timestamp,
        suggestions: response.data.suggestions || []
      }

      currentConversation.value.messages.push(aiMessage)
      currentConversation.value.updatedAt = aiMessage.timestamp
      currentConversation.value.title = generateConversationTitle(currentConversation.value.messages)

      // æ›´æ–°ç›¸å…³å†…å®¹
      updateRelevantContent()
    }
  } catch (error) {
    ElMessage.error('å‘é€æ¶ˆæ¯å¤±è´¥')
  } finally {
    isTyping.value = false
    await nextTick()
    scrollToBottom()
  }
}

// ç”Ÿæˆå¯¹è¯æ ‡é¢˜
const generateConversationTitle = (messages) => {
  const userMessages = messages.filter(msg => msg.type === 'user')
  if (userMessages.length > 0) {
    const firstMessage = userMessages[0].content
    return firstMessage.length > 20 ? firstMessage.substring(0, 20) + '...' : firstMessage
  }
  return 'æ–°å¯¹è¯'
}

// æ»šåŠ¨åˆ°åº•éƒ¨
const scrollToBottom = () => {
  if (messagesContainer.value) {
    messagesContainer.value.scrollTop = messagesContainer.value.scrollHeight
  }
}

// æ›´æ–°ç›¸å…³å†…å®¹
const updateRelevantContent = () => {
  // æ ¹æ®å¯¹è¯å†…å®¹æ›´æ–°ç›¸å…³çš„çŸ¥è¯†å¡ç‰‡å’Œä»£ç ç¤ºä¾‹
  if (currentConversation.value && currentConversation.value.messages.length > 0) {
    // æ¨¡æ‹Ÿæ›´æ–°ç›¸å…³æç¤º
    getRelevantHints()

    // æ¨¡æ‹Ÿç”Ÿæˆä»£ç ç¤ºä¾‹
    if (Math.random() > 0.5) {
      codeExamples.value = [
        {
          id: 1,
          concept: 'é—­åŒ…',
          language: 'JavaScript',
          code: `function counter() {\n  let count = 0;\n  return function() {\n    count++;\n    return count;\n  };\n}`
        }
      ]
    }
  }
}

// æ¸…ç©ºå¯¹è¯
const clearChat = async () => {
  if (!currentConversation.value) return

  try {
    await ElMessageBox.confirm('ç¡®å®šè¦æ¸…ç©ºå½“å‰å¯¹è¯å—ï¼Ÿ', 'æç¤º', {
      confirmButtonText: 'ç¡®å®š',
      cancelButtonText: 'å–æ¶ˆ',
      type: 'warning'
    })

    currentConversation.value.messages = []
    ElMessage.success('å¯¹è¯å·²æ¸…ç©º')
  } catch (error) {
    // ç”¨æˆ·å–æ¶ˆ
  }
}

// å¯¼å‡ºå¯¹è¯
const exportChat = () => {
  if (!currentConversation.value) return

  // æ¨¡æ‹Ÿå¯¼å‡ºå¯¹è¯
  const content = currentConversation.value.messages
    .map(msg => `[${msg.timestamp}] ${msg.type === 'user' ? 'ç”¨æˆ·' : 'AIåŠ©æ•™'}: ${msg.content}`)
    .join('\n\n')

  const blob = new Blob([content], { type: 'text/plain' })
  const url = URL.createObjectURL(blob)
  const a = document.createElement('a')
  a.href = url
  a.download = `${currentConversation.value.title}.txt`
  a.click()
  URL.revokeObjectURL(url)

  ElMessage.success('å¯¹è¯å¯¼å‡ºæˆåŠŸ')
}

// å¿«é€Ÿæ“ä½œ
const askAboutConcept = () => {
  inputMessage.value = 'è¯·è§£é‡ŠJavaScriptä¸­çš„é‡è¦æ¦‚å¿µ'
}

const analyzeCode = () => {
  inputMessage.value = 'è¯·å¸®æˆ‘åˆ†æè¿™æ®µä»£ç çš„é—®é¢˜ï¼šfunction factorial(n) { return n * factorial(n - 1); }'
}

const getHint = () => {
  inputMessage.value = 'æˆ‘åœ¨å­¦ä¹ é€’å½’æ—¶é‡åˆ°äº†å›°éš¾ï¼Œèƒ½ç»™ä¸€äº›å­¦ä¹ å»ºè®®å—ï¼Ÿ'
}

// è®¾ç½®å¿«é€Ÿé—®é¢˜
const setQuickQuestion = (question) => {
  inputMessage.value = question
}

// å·¥å…·æ æ“ä½œ
const insertCodeBlock = () => {
  inputMessage.value += '\n```javascript\n// åœ¨è¿™é‡Œè¾“å…¥ä½ çš„ä»£ç \n```\n'
}

const attachFile = () => {
  ElMessage.info('æ–‡ä»¶ä¸Šä¼ åŠŸèƒ½å¼€å‘ä¸­...')
}

const voiceInput = () => {
  ElMessage.info('è¯­éŸ³è¾“å…¥åŠŸèƒ½å¼€å‘ä¸­...')
}

// æ‰“å¼€å»ºè®®
const openSuggestion = (suggestion) => {
  inputMessage.value = `æˆ‘æƒ³äº†è§£æ›´å¤šå…³äº"${suggestion.title}"çš„å†…å®¹`
  sendMessage()
}

// åº”ç”¨å»ºè®®
const applySuggestion = (suggestion) => {
  inputMessage.value = suggestion.title
  sendMessage()
}

// æŸ¥çœ‹æç¤ºè¯¦æƒ…
const viewHint = (hint) => {
  currentHint.value = hint
  showHintDialog.value = true
}

// å¤åˆ¶ä»£ç 
const copyCode = async (code) => {
  try {
    await navigator.clipboard.writeText(code)
    ElMessage.success('ä»£ç å·²å¤åˆ¶åˆ°å‰ªè´´æ¿')
  } catch (error) {
    ElMessage.error('å¤åˆ¶å¤±è´¥')
  }
}

// æ ¼å¼åŒ–æ—¶é—´
const formatTime = (timeString) => {
  const date = new Date(timeString)
  const now = new Date()
  const diff = now - date
  const days = Math.floor(diff / (1000 * 60 * 60 * 24))

  if (days === 0) {
    return date.toLocaleTimeString('zh-CN', { hour: '2-digit', minute: '2-digit' })
  } else if (days === 1) {
    return 'æ˜¨å¤©'
  } else if (days < 7) {
    return `${days}å¤©å‰`
  } else {
    return date.toLocaleDateString('zh-CN', { month: 'short', day: 'numeric' })
  }
}

// æ ¼å¼åŒ–æ¶ˆæ¯å†…å®¹
const formatMessage = (content) => {
  return content
    .replace(/\n/g, '<br>')
    .replace(/```(\w+)?\n([\s\S]*?)\n```/g, '<pre class="code-block"><code>$2</code></pre>')
    .replace(/`([^`]+)`/g, '<code class="inline-code">$1</code>')
    .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
    .replace(/\*(.*?)\*/g, '<em>$1</em>')
}

// è·å–å»ºè®®å›¾æ ‡
const getSuggestionIcon = (type) => {
  const iconMap = {
    concept: 'Reading',
    exercise: 'EditPen',
    reading: 'Document'
  }
  return iconMap[type] || 'Guide'
}

// è·å–ä¼˜å…ˆçº§ç±»å‹
const getPriorityType = (priority) => {
  const typeMap = {
    high: 'danger',
    medium: 'warning',
    low: 'info'
  }
  return typeMap[priority] || 'info'
}

// è·å–ä¼˜å…ˆçº§æ ‡ç­¾
const getPriorityLabel = (priority) => {
  const labelMap = {
    high: 'é«˜ä¼˜å…ˆçº§',
    medium: 'ä¸­ä¼˜å…ˆçº§',
    low: 'ä½ä¼˜å…ˆçº§'
  }
  return labelMap[priority] || 'æ™®é€š'
}

// è·å–éš¾åº¦ç±»å‹
const getDifficultyType = (difficulty) => {
  const typeMap = {
    beginner: 'success',
    intermediate: 'warning',
    advanced: 'danger'
  }
  return typeMap[difficulty] || 'info'
}

// è·å–éš¾åº¦æ ‡ç­¾
const getDifficultyLabel = (difficulty) => {
  const labelMap = {
    beginner: 'åˆçº§',
    intermediate: 'ä¸­çº§',
    advanced: 'é«˜çº§'
  }
  return labelMap[difficulty] || 'æœªçŸ¥'
}

// ç»„ä»¶æŒ‚è½½
onMounted(() => {
  getConversations()
  getSuggestions()
  getRelevantHints()
})
</script>

<style scoped>
.ai-assistant {
  height: 100vh;
  background: #f5f5f5;
}

.assistant-container {
  display: flex;
  height: 100%;
}

/* å·¦ä¾§è¾¹æ  */
.sidebar {
  width: 300px;
  background: white;
  border-right: 1px solid #e4e7ed;
  display: flex;
  flex-direction: column;
}

.sidebar-header {
  padding: 20px;
  border-bottom: 1px solid #e4e7ed;
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.sidebar-header h3 {
  margin: 0;
  color: #303133;
}

.conversation-list {
  flex: 1;
  overflow-y: auto;
  padding: 10px;
}

.conversation-item {
  padding: 12px;
  margin-bottom: 8px;
  border-radius: 8px;
  cursor: pointer;
  transition: background-color 0.3s;
  position: relative;
}

.conversation-item:hover {
  background: #f5f7fa;
}

.conversation-item.active {
  background: #ecf5ff;
  border-left: 3px solid #409eff;
}

.conversation-title {
  font-weight: 500;
  color: #303133;
  margin-bottom: 4px;
}

.conversation-meta {
  display: flex;
  justify-content: space-between;
  font-size: 12px;
  color: #909399;
}

.conversation-actions {
  position: absolute;
  top: 8px;
  right: 8px;
  opacity: 0;
  transition: opacity 0.3s;
}

.conversation-item:hover .conversation-actions {
  opacity: 1;
}

.suggestions-panel {
  padding: 20px;
  border-top: 1px solid #e4e7ed;
}

.suggestions-panel h4 {
  margin: 0 0 12px 0;
  color: #303133;
}

.suggestion-list {
  max-height: 200px;
  overflow-y: auto;
}

.suggestion-item {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 8px;
  margin-bottom: 8px;
  border-radius: 6px;
  background: #f9f9f9;
  cursor: pointer;
  transition: background-color 0.3s;
}

.suggestion-item:hover {
  background: #ecf5ff;
}

.suggestion-content {
  flex: 1;
}

.suggestion-title {
  font-size: 12px;
  font-weight: 500;
  color: #303133;
}

.suggestion-desc {
  font-size: 11px;
  color: #909399;
  margin-top: 2px;
}

/* ä¸»è¦å†…å®¹åŒºåŸŸ */
.main-content {
  flex: 1;
  display: flex;
  flex-direction: column;
  background: white;
}

.chat-header {
  padding: 20px;
  border-bottom: 1px solid #e4e7ed;
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.chat-title h3 {
  margin: 0 0 8px 0;
  color: #303133;
}

.chat-context {
  display: flex;
  gap: 8px;
}

.chat-actions {
  display: flex;
  gap: 8px;
}

.chat-messages {
  flex: 1;
  overflow-y: auto;
  padding: 20px;
}

.welcome-message {
  display: flex;
  justify-content: center;
  align-items: center;
  height: 100%;
}

.welcome-content {
  text-align: center;
  max-width: 500px;
}

.welcome-icon {
  font-size: 64px;
  color: #409eff;
  margin-bottom: 20px;
}

.welcome-content h2 {
  margin: 0 0 16px 0;
  color: #303133;
}

.welcome-content p {
  color: #606266;
  margin-bottom: 20px;
}

.welcome-content ul {
  text-align: left;
  color: #606266;
  margin-bottom: 30px;
}

.welcome-content li {
  margin-bottom: 8px;
}

.quick-actions {
  display: flex;
  gap: 12px;
  justify-content: center;
}

.messages-list {
  min-height: 100%;
}

.message {
  display: flex;
  margin-bottom: 20px;
  align-items: flex-start;
  gap: 12px;
}

.message.user {
  flex-direction: row-reverse;
}

.message.user .message-content {
  background: #409eff;
  color: white;
}

.message-content {
  max-width: 70%;
  padding: 12px 16px;
  border-radius: 12px;
  background: #f4f4f5;
  position: relative;
}

.message-text {
  line-height: 1.6;
  word-wrap: break-word;
}

.message-time {
  font-size: 12px;
  margin-top: 8px;
  opacity: 0.7;
}

.message-suggestions {
  margin-top: 12px;
  display: flex;
  flex-wrap: wrap;
  gap: 8px;
}

.suggestion-chip {
  display: flex;
  align-items: center;
  gap: 4px;
  padding: 6px 12px;
  background: rgba(64, 158, 255, 0.1);
  border: 1px solid #409eff;
  border-radius: 16px;
  color: #409eff;
  font-size: 12px;
  cursor: pointer;
  transition: background-color 0.3s;
}

.suggestion-chip:hover {
  background: rgba(64, 158, 255, 0.2);
}

.typing-indicator {
  display: flex;
  align-items: center;
  gap: 12px;
  margin-bottom: 20px;
}

.typing-dots {
  display: flex;
  gap: 4px;
  padding: 12px 16px;
  background: #f4f4f5;
  border-radius: 12px;
}

.typing-dots span {
  width: 8px;
  height: 8px;
  background: #909399;
  border-radius: 50%;
  animation: typing 1.4s infinite;
}

.typing-dots span:nth-child(2) {
  animation-delay: 0.2s;
}

.typing-dots span:nth-child(3) {
  animation-delay: 0.4s;
}

@keyframes typing {
  0%, 60%, 100% {
    transform: translateY(0);
  }
  30% {
    transform: translateY(-10px);
  }
}

.chat-input {
  padding: 20px;
  border-top: 1px solid #e4e7ed;
}

.input-toolbar {
  margin-bottom: 12px;
  display: flex;
  gap: 8px;
}

.input-area {
  display: flex;
  gap: 12px;
  align-items: flex-end;
}

.input-area .el-textarea {
  flex: 1;
}

.quick-questions {
  margin-top: 12px;
  display: flex;
  align-items: center;
  gap: 8px;
  flex-wrap: wrap;
}

.quick-questions span {
  font-size: 12px;
  color: #909399;
}

/* å³ä¾§é¢æ¿ */
.right-panel {
  width: 300px;
  background: white;
  border-left: 1px solid #e4e7ed;
  padding: 20px;
  overflow-y: auto;
}

.knowledge-cards,
.code-examples {
  margin-bottom: 30px;
}

.knowledge-cards h4,
.code-examples h4 {
  margin: 0 0 16px 0;
  color: #303133;
}

.knowledge-card {
  border: 1px solid #e4e7ed;
  border-radius: 8px;
  padding: 12px;
  margin-bottom: 12px;
}

.card-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 8px;
}

.card-header h5 {
  margin: 0;
  font-size: 14px;
  color: #303133;
}

.card-content {
  font-size: 12px;
  color: #606266;
  line-height: 1.5;
  margin-bottom: 8px;
}

.card-footer {
  text-align: right;
}

.code-example {
  border: 1px solid #e4e7ed;
  border-radius: 8px;
  overflow: hidden;
  margin-bottom: 12px;
}

.example-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 8px 12px;
  background: #f5f7fa;
  border-bottom: 1px solid #e4e7ed;
  font-size: 12px;
  color: #606266;
}

.code-block {
  margin: 0;
  padding: 12px;
  background: #f8f8f8;
  font-size: 12px;
  line-height: 1.4;
  overflow-x: auto;
}

.hint-detail {
  max-height: 500px;
  overflow-y: auto;
}

.hint-meta {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 16px;
}

.hint-tags {
  display: flex;
  gap: 4px;
}

.hint-content {
  line-height: 1.8;
  color: #303133;
}

/* æ ·å¼é‡å†™ */
:deep(.ai-avatar) {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
}

:deep(.code-block) {
  background: #2d2d2d;
  color: #f8f8f2;
  border-radius: 4px;
  padding: 12px;
  font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
  font-size: 13px;
  line-height: 1.4;
  overflow-x: auto;
}

:deep(.inline-code) {
  background: #f1f1f1;
  padding: 2px 6px;
  border-radius: 3px;
  font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
  font-size: 13px;
  color: #e83e8c;
}

:deep(.el-textarea__inner) {
  border-radius: 12px;
}

:deep(.el-button--text) {
  padding: 4px 8px;
}
</style>